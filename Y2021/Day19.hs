module AdventOfCode.Y2021.Day19 where

import AdventOfCode.Common.Vector3
import AdventOfCode.Common.List

import Control.Monad

import Data.List
import Data.Maybe

--------------------------------------------------------------------------------

type Beacons = [Vector Int]
type Diffs = [Vector Int]

data Scanner = Scanner Int Beacons
   deriving (Show)

printScanner :: Scanner -> IO ()
printScanner (Scanner n vs) = do
   putStrLn ("--- scanner " ++ show n ++ " ---")
   forM_ vs (putStrLn . init . tail . show)
   putStrLn ""


data KnownBeacons = KnownBeacons Beacons Diffs [Vector Int]
   deriving (Show)

diffSet :: KnownBeacons -> Diffs
diffSet (KnownBeacons _ ds _) = ds

translations :: KnownBeacons -> [Vector Int]
translations (KnownBeacons _ _ ts) = ts

makeKnownBeacons :: Beacons -> KnownBeacons
makeKnownBeacons bs = KnownBeacons bs (diffs bs) []


class HasBeacons a where
   beacons :: a -> Beacons

instance HasBeacons Scanner where
   beacons (Scanner _ bs) = bs

instance HasBeacons KnownBeacons where
   beacons (KnownBeacons bs _ _) = bs

--------------------------------------------------------------------------------

matchingThreshold = 12 :: Int
matchingThresholdPairs = sum [1 .. matchingThreshold-1] :: Int

getRotations :: Scanner -> [Scanner]
getRotations (Scanner n vs) = [Scanner n $ map (applyTransform r) vs | r <- rotations]

diffs :: Beacons -> Diffs
diffs vs = do
   (u:vs') <- tails $ sort vs
   v <- vs'
   return (u - v)

-- Given a set of "true" beacon locations and a rotated scanner,
-- determine if the scanner readings can be translated to overlap the known beacons
hasTranslation :: KnownBeacons -> Scanner -> Bool
hasTranslation known scanner = hasLength matchingThresholdPairs
   $ intersect (diffSet known) (diffs $ beacons scanner)

-- Given a set of "true" beacon locations and a rotated scanner,
-- translate the scanner readings so they overlap the known beacons
-- Joins the two sets together to get a new view "true" view
getAligned :: KnownBeacons -> Scanner -> Maybe (Beacons, Vector Int)
getAligned known scanner = listToMaybe $ do
   let xs = beacons known
   let ys = beacons scanner
   x <- xs
   y <- ys
   let t = x - y
   let ys' = map (t+) ys
   let u = union xs ys'
   -- Equivalent to guard (length (intersect xs ys') >= matchingThreshold)
   -- Do it this way since we have to compute the union anyway
   guard (length u + matchingThreshold <= length xs + length ys')
   return (u,t)

-- Aligns and adds scanner readings to a set of "true" beacon locations
align :: KnownBeacons -> Scanner -> Maybe KnownBeacons
align known scanner = listToMaybe $ do
   rotScan <- getRotations scanner
   guard $ hasTranslation known rotScan
   (u,t) <- maybeToList (getAligned known rotScan)
   return $ KnownBeacons u (diffs u) (t : translations known)

triangulate :: [Scanner] -> KnownBeacons
triangulate (s:ss) = aux (makeKnownBeacons $ beacons s) ss where
   aux :: KnownBeacons -> [Scanner] -> KnownBeacons
   aux known [] = known
   aux known (s:c) = case align known s of
      Just k -> aux k c
      Nothing -> aux known (c ++ [s])

part1 :: [Scanner] -> Int
part1 = length . beacons . triangulate

--------------------------------------------------------------------------------

manhattan :: Vector Int -> Int
manhattan (Vec x y z) = abs x + abs y + abs z

part2 :: [Scanner] -> Int
part2 = maximum . map manhattan . diffs . translations . triangulate

--------------------------------------------------------------------------------

makeScanner :: Int -> [Vector Int] -> Scanner
makeScanner n vs = Scanner n vs

sampleInput :: [Scanner]
sampleInput = 
   [ makeScanner 0 [Vec(404)(-588)(-901), Vec(528)(-643)(409), Vec(-838)(591)(734), Vec(390)(-675)(-793), Vec(-537)(-823)(-458), Vec(-485)(-357)(347), Vec(-345)(-311)(381), Vec(-661)(-816)(-575), Vec(-876)(649)(763), Vec(-618)(-824)(-621), Vec(553)(345)(-567), Vec(474)(580)(667), Vec(-447)(-329)(318), Vec(-584)(868)(-557), Vec(544)(-627)(-890), Vec(564)(392)(-477), Vec(455)(729)(728), Vec(-892)(524)(684), Vec(-689)(845)(-530), Vec(423)(-701)(434), Vec(7)(-33)(-71), Vec(630)(319)(-379), Vec(443)(580)(662), Vec(-789)(900)(-551), Vec(459)(-707)(401)]
   , makeScanner 1 [Vec(686)(422)(578), Vec(605)(423)(415), Vec(515)(917)(-361), Vec(-336)(658)(858), Vec(95)(138)(22), Vec(-476)(619)(847), Vec(-340)(-569)(-846), Vec(567)(-361)(727), Vec(-460)(603)(-452), Vec(669)(-402)(600), Vec(729)(430)(532), Vec(-500)(-761)(534), Vec(-322)(571)(750), Vec(-466)(-666)(-811), Vec(-429)(-592)(574), Vec(-355)(545)(-477), Vec(703)(-491)(-529), Vec(-328)(-685)(520), Vec(413)(935)(-424), Vec(-391)(539)(-444), Vec(586)(-435)(557), Vec(-364)(-763)(-893), Vec(807)(-499)(-711), Vec(755)(-354)(-619), Vec(553)(889)(-390)]
   , makeScanner 2 [Vec(649)(640)(665), Vec(682)(-795)(504), Vec(-784)(533)(-524), Vec(-644)(584)(-595), Vec(-588)(-843)(648), Vec(-30)(6)(44), Vec(-674)(560)(763), Vec(500)(723)(-460), Vec(609)(671)(-379), Vec(-555)(-800)(653), Vec(-675)(-892)(-343), Vec(697)(-426)(-610), Vec(578)(704)(681), Vec(493)(664)(-388), Vec(-671)(-858)(530), Vec(-667)(343)(800), Vec(571)(-461)(-707), Vec(-138)(-166)(112), Vec(-889)(563)(-600), Vec(646)(-828)(498), Vec(640)(759)(510), Vec(-630)(509)(768), Vec(-681)(-892)(-333), Vec(673)(-379)(-804), Vec(-742)(-814)(-386), Vec(577)(-820)(562)]
   , makeScanner 3 [Vec(-589)(542)(597), Vec(605)(-692)(669), Vec(-500)(565)(-823), Vec(-660)(373)(557), Vec(-458)(-679)(-417), Vec(-488)(449)(543), Vec(-626)(468)(-788), Vec(338)(-750)(-386), Vec(528)(-832)(-391), Vec(562)(-778)(733), Vec(-938)(-730)(414), Vec(543)(643)(-506), Vec(-524)(371)(-870), Vec(407)(773)(750), Vec(-104)(29)(83), Vec(378)(-903)(-323), Vec(-778)(-728)(485), Vec(426)(699)(580), Vec(-438)(-605)(-362), Vec(-469)(-447)(-387), Vec(509)(732)(623), Vec(647)(635)(-688), Vec(-868)(-804)(481), Vec(614)(-800)(639), Vec(595)(780)(-596)]
   , makeScanner 4 [Vec(727)(592)(562), Vec(-293)(-554)(779), Vec(441)(611)(-461), Vec(-714)(465)(-776), Vec(-743)(427)(-804), Vec(-660)(-479)(-426), Vec(832)(-632)(460), Vec(927)(-485)(-438), Vec(408)(393)(-506), Vec(466)(436)(-512), Vec(110)(16)(151), Vec(-258)(-428)(682), Vec(-393)(719)(612), Vec(-211)(-452)(876), Vec(808)(-476)(-593), Vec(-575)(615)(604), Vec(-485)(667)(467), Vec(-680)(325)(-822), Vec(-627)(-443)(-432), Vec(872)(-547)(-609), Vec(833)(512)(582), Vec(807)(604)(487), Vec(839)(-516)(451), Vec(891)(-625)(532), Vec(-652)(-548)(-490), Vec(30)(-46)(-14)] ]

myInput :: [Scanner]
myInput =
   [ makeScanner 0 [Vec(592)(476)(409),Vec(451)(462)(-479),Vec(840)(-352)(632),Vec(619)(398)(366),Vec(584)(458)(-482),Vec(794)(-340)(778),Vec(462)(524)(-410),Vec(-26)(36)(-166),Vec(-518)(712)(-554),Vec(-524)(544)(-667),Vec(-364)(758)(518),Vec(542)(430)(440),Vec(87)(115)(17),Vec(-380)(-427)(-609),Vec(863)(-333)(586),Vec(-422)(566)(-511),Vec(-756)(-510)(685),Vec(-806)(-704)(722),Vec(-408)(800)(678),Vec(-450)(839)(466),Vec(-514)(-291)(-633),Vec(-485)(-380)(-513),Vec(557)(-392)(-606),Vec(-788)(-610)(775),Vec(481)(-347)(-441),Vec(578)(-334)(-581)]
   , makeScanner 1 [Vec(-583)(-765)(-719),Vec(632)(295)(485),Vec(636)(327)(350),Vec(-657)(380)(343),Vec(599)(-732)(-645),Vec(-621)(253)(313),Vec(678)(357)(398),Vec(-736)(626)(-578),Vec(-503)(-949)(296),Vec(-740)(733)(-663),Vec(-719)(286)(402),Vec(554)(772)(-816),Vec(590)(-602)(633),Vec(692)(727)(-916),Vec(-601)(-833)(-688),Vec(538)(-677)(-732),Vec(-622)(-850)(299),Vec(-13)(-191)(-155),Vec(580)(-630)(724),Vec(-562)(-977)(-745),Vec(566)(-781)(-633),Vec(538)(732)(-855),Vec(-499)(-953)(313),Vec(-72)(-48)(-13),Vec(686)(-608)(696),Vec(-800)(649)(-736)]
   , makeScanner 2 [Vec(-516)(-454)(605),Vec(408)(-415)(759),Vec(-693)(-252)(-394),Vec(809)(-355)(-358),Vec(594)(799)(-361),Vec(539)(788)(-397),Vec(-538)(-352)(761),Vec(-430)(654)(790),Vec(362)(648)(691),Vec(420)(627)(666),Vec(-496)(532)(862),Vec(-34)(99)(76),Vec(767)(-316)(-493),Vec(-684)(-448)(718),Vec(-752)(-304)(-381),Vec(615)(807)(-538),Vec(-649)(805)(-656),Vec(375)(551)(831),Vec(-646)(815)(-771),Vec(-489)(744)(-720),Vec(-434)(521)(793),Vec(455)(-310)(663),Vec(-694)(-298)(-575),Vec(824)(-304)(-343),Vec(319)(-444)(639)]
   , makeScanner 3 [Vec(515)(800)(717),Vec(476)(790)(601),Vec(463)(-650)(526),Vec(-140)(-121)(-18),Vec(-406)(578)(666),Vec(-886)(-536)(558),Vec(-725)(355)(-610),Vec(-512)(-509)(-627),Vec(516)(383)(-474),Vec(-745)(-517)(634),Vec(398)(785)(695),Vec(-563)(-580)(-470),Vec(-884)(343)(-589),Vec(473)(-634)(436),Vec(-627)(-519)(-630),Vec(-417)(508)(572),Vec(376)(-469)(-446),Vec(678)(337)(-535),Vec(473)(-689)(409),Vec(-821)(358)(-537),Vec(-922)(-525)(613),Vec(372)(-374)(-564),Vec(-420)(562)(489),Vec(-19)(59)(-29),Vec(663)(476)(-423),Vec(426)(-365)(-376)]
   , makeScanner 4 [Vec(-946)(524)(517),Vec(439)(453)(813),Vec(-634)(505)(-587),Vec(-503)(-517)(-469),Vec(-780)(-589)(508),Vec(381)(521)(728),Vec(-797)(-767)(569),Vec(593)(-977)(-487),Vec(483)(-865)(-448),Vec(-420)(-477)(-415),Vec(-490)(572)(-567),Vec(595)(425)(-582),Vec(254)(498)(748),Vec(-820)(-706)(431),Vec(-805)(477)(427),Vec(-887)(597)(486),Vec(314)(-917)(364),Vec(-36)(-47)(-34),Vec(-481)(-604)(-352),Vec(463)(425)(-692),Vec(344)(-786)(331),Vec(686)(-924)(-419),Vec(326)(-647)(357),Vec(-566)(700)(-552),Vec(418)(420)(-649)]
   , makeScanner 5 [Vec(574)(-507)(745),Vec(-493)(482)(-596),Vec(449)(416)(545),Vec(413)(561)(535),Vec(512)(747)(-503),Vec(-777)(-627)(794),Vec(449)(-632)(765),Vec(450)(437)(649),Vec(-503)(-655)(-745),Vec(177)(20)(135),Vec(-677)(527)(-582),Vec(562)(-591)(810),Vec(-725)(487)(-566),Vec(-676)(-729)(744),Vec(695)(664)(-510),Vec(-599)(-663)(-763),Vec(551)(-622)(-262),Vec(-707)(549)(456),Vec(631)(756)(-530),Vec(-706)(-601)(686),Vec(-638)(567)(415),Vec(-480)(-591)(-682),Vec(564)(-803)(-306),Vec(-561)(510)(377),Vec(530)(-760)(-396),Vec(170)(-156)(-5)]
   , makeScanner 6 [Vec(70)(-153)(-116),Vec(823)(-780)(467),Vec(-428)(-886)(547),Vec(-784)(264)(367),Vec(-746)(384)(336),Vec(917)(352)(819),Vec(-362)(-779)(548),Vec(-437)(-518)(-418),Vec(850)(474)(816),Vec(489)(421)(-516),Vec(706)(-590)(-600),Vec(670)(-523)(-575),Vec(769)(-585)(-563),Vec(-787)(248)(448),Vec(769)(-792)(536),Vec(-426)(-867)(418),Vec(-763)(498)(-449),Vec(505)(470)(-357),Vec(-635)(-520)(-504),Vec(60)(8)(77),Vec(879)(-854)(614),Vec(489)(583)(-406),Vec(-543)(-530)(-503),Vec(-744)(491)(-470),Vec(-571)(495)(-377),Vec(856)(368)(801)]
   , makeScanner 7 [Vec(-816)(-494)(765),Vec(551)(-688)(-507),Vec(664)(410)(435),Vec(-531)(464)(-659),Vec(-91)(59)(74),Vec(-940)(-528)(-685),Vec(484)(-511)(-502),Vec(-113)(-91)(-60),Vec(-972)(-605)(-759),Vec(581)(473)(-782),Vec(-800)(755)(444),Vec(646)(-686)(895),Vec(441)(-556)(-507),Vec(714)(-779)(842),Vec(-894)(-578)(-716),Vec(-707)(-614)(769),Vec(566)(397)(-654),Vec(546)(541)(-587),Vec(-801)(-574)(674),Vec(-700)(797)(517),Vec(781)(388)(522),Vec(-612)(378)(-607),Vec(718)(327)(395),Vec(-641)(795)(445),Vec(-570)(422)(-447),Vec(685)(-576)(783)]
   , makeScanner 8 [Vec(683)(432)(-620),Vec(648)(388)(326),Vec(428)(-449)(737),Vec(760)(479)(420),Vec(-726)(438)(680),Vec(428)(411)(-643),Vec(-690)(-771)(-767),Vec(735)(-428)(-659),Vec(-761)(-788)(-777),Vec(762)(412)(440),Vec(635)(480)(-635),Vec(794)(-362)(-603),Vec(783)(-437)(-546),Vec(-559)(-547)(411),Vec(-710)(356)(690),Vec(-615)(-756)(-760),Vec(-761)(439)(-479),Vec(366)(-495)(650),Vec(-121)(87)(50),Vec(-531)(-537)(502),Vec(38)(-53)(47),Vec(-838)(386)(559),Vec(398)(-491)(785),Vec(-537)(-441)(439),Vec(-781)(519)(-567),Vec(-756)(402)(-414)]
   , makeScanner 9 [Vec(16)(20)(38),Vec(-613)(-770)(-662),Vec(708)(849)(522),Vec(799)(-809)(823),Vec(-617)(-793)(-713),Vec(-498)(-465)(324),Vec(-527)(-614)(325),Vec(-557)(767)(-441),Vec(-535)(610)(807),Vec(-570)(740)(-455),Vec(-432)(555)(805),Vec(349)(843)(-447),Vec(567)(-815)(-695),Vec(761)(-809)(-753),Vec(649)(-797)(766),Vec(570)(861)(594),Vec(784)(-758)(808),Vec(326)(893)(-504),Vec(426)(832)(-403),Vec(-437)(-493)(409),Vec(587)(820)(497),Vec(-483)(712)(806),Vec(-109)(77)(-106),Vec(748)(-861)(-694),Vec(-458)(691)(-434),Vec(-534)(-877)(-758)]
   , makeScanner 10 [Vec(-639)(700)(813),Vec(733)(-498)(-443),Vec(-864)(487)(-594),Vec(-796)(678)(855),Vec(-574)(-478)(-653),Vec(549)(-858)(511),Vec(452)(-899)(528),Vec(-802)(407)(-710),Vec(728)(631)(-683),Vec(280)(759)(449),Vec(-645)(-785)(574),Vec(-494)(-498)(-741),Vec(238)(720)(314),Vec(-100)(58)(-138),Vec(-173)(-132)(-72),Vec(-773)(627)(813),Vec(-885)(333)(-648),Vec(-457)(-503)(-806),Vec(592)(765)(-707),Vec(223)(771)(299),Vec(524)(-887)(390),Vec(639)(660)(-803),Vec(-653)(-855)(507),Vec(716)(-569)(-453),Vec(4)(-129)(49),Vec(701)(-644)(-460),Vec(-576)(-665)(484)]
   , makeScanner 11 [Vec(731)(717)(-760),Vec(668)(-387)(-578),Vec(-380)(926)(-955),Vec(1)(118)(-6),Vec(-380)(-650)(-917),Vec(739)(-544)(-527),Vec(-312)(-655)(378),Vec(729)(-547)(-642),Vec(-392)(869)(-805),Vec(-374)(-592)(-723),Vec(779)(-363)(361),Vec(-431)(911)(-940),Vec(-724)(427)(342),Vec(-419)(-559)(457),Vec(559)(492)(458),Vec(27)(-15)(-183),Vec(874)(-481)(357),Vec(-575)(428)(371),Vec(723)(696)(-937),Vec(-396)(-610)(461),Vec(598)(609)(448),Vec(614)(519)(458),Vec(-328)(-591)(-904),Vec(883)(-293)(411),Vec(-696)(512)(281),Vec(712)(641)(-901)]
   , makeScanner 12 [Vec(-128)(119)(58),Vec(818)(-391)(610),Vec(-735)(-368)(-468),Vec(-737)(629)(862),Vec(650)(486)(-431),Vec(377)(-491)(-459),Vec(-595)(-643)(561),Vec(740)(-434)(583),Vec(672)(642)(-533),Vec(754)(454)(442),Vec(-693)(834)(-723),Vec(758)(457)(575),Vec(-638)(-648)(516),Vec(-720)(-496)(-392),Vec(-781)(570)(861),Vec(-785)(644)(-718),Vec(416)(-703)(-417),Vec(-761)(818)(-651),Vec(-855)(750)(871),Vec(-18)(-14)(-89),Vec(458)(-543)(-373),Vec(692)(385)(453),Vec(504)(529)(-527),Vec(-700)(-563)(-536),Vec(786)(-465)(533),Vec(-705)(-643)(693)]
   , makeScanner 13 [Vec(799)(-448)(728),Vec(-781)(-606)(-858),Vec(-598)(-623)(566),Vec(-603)(-446)(633),Vec(-855)(-529)(-890),Vec(-603)(-578)(523),Vec(578)(-560)(-719),Vec(746)(-355)(796),Vec(401)(551)(543),Vec(406)(614)(580),Vec(-812)(-556)(-812),Vec(687)(-558)(767),Vec(608)(551)(-556),Vec(596)(497)(-487),Vec(-552)(464)(-821),Vec(-605)(831)(496),Vec(339)(650)(555),Vec(-536)(403)(-839),Vec(-767)(831)(386),Vec(673)(-520)(-625),Vec(-166)(56)(-81),Vec(-658)(470)(-836),Vec(-654)(815)(337),Vec(670)(441)(-634),Vec(669)(-640)(-734),Vec(-107)(152)(79)]
   , makeScanner 14 [Vec(572)(547)(-573),Vec(-659)(601)(-306),Vec(-55)(-17)(-88),Vec(855)(-838)(-532),Vec(662)(-712)(809),Vec(64)(-82)(103),Vec(642)(-645)(665),Vec(814)(337)(879),Vec(795)(-763)(-468),Vec(-604)(459)(409),Vec(760)(377)(796),Vec(-722)(-457)(-330),Vec(-599)(-443)(-433),Vec(-516)(-665)(828),Vec(584)(524)(-534),Vec(-545)(387)(411),Vec(804)(-849)(-560),Vec(677)(-840)(733),Vec(-620)(544)(-450),Vec(-704)(386)(451),Vec(-718)(-440)(-334),Vec(-435)(-717)(742),Vec(877)(464)(818),Vec(-474)(-505)(784),Vec(570)(565)(-740),Vec(-638)(575)(-518)]
   , makeScanner 15 [Vec(25)(3)(138),Vec(668)(345)(-425),Vec(566)(-777)(422),Vec(800)(546)(390),Vec(751)(513)(371),Vec(-528)(311)(-610),Vec(413)(-799)(449),Vec(-826)(-657)(-821),Vec(826)(405)(-436),Vec(-510)(382)(590),Vec(-876)(-642)(-818),Vec(-550)(269)(-453),Vec(-601)(311)(-476),Vec(547)(-339)(-463),Vec(552)(-385)(-517),Vec(698)(296)(-450),Vec(-740)(-664)(-755),Vec(549)(-846)(550),Vec(697)(664)(367),Vec(-941)(-796)(935),Vec(-110)(-62)(24),Vec(-884)(-817)(715),Vec(550)(-500)(-487),Vec(-863)(-710)(801),Vec(-580)(368)(636),Vec(-590)(296)(676)]
   , makeScanner 16 [Vec(-439)(-831)(824),Vec(-779)(377)(-635),Vec(-555)(704)(405),Vec(406)(-895)(656),Vec(725)(-844)(-276),Vec(-594)(-569)(-449),Vec(709)(-826)(-337),Vec(494)(381)(-704),Vec(656)(491)(-704),Vec(-735)(778)(395),Vec(-613)(-556)(-328),Vec(449)(-817)(683),Vec(-25)(68)(-10),Vec(-370)(-769)(813),Vec(663)(561)(750),Vec(658)(628)(573),Vec(-614)(660)(404),Vec(-853)(470)(-705),Vec(480)(-863)(733),Vec(607)(332)(-688),Vec(-565)(-609)(-299),Vec(-862)(411)(-632),Vec(603)(-841)(-343),Vec(658)(518)(705),Vec(-442)(-835)(691),Vec(-129)(-31)(97)]
   , makeScanner 17 [Vec(701)(-567)(-678),Vec(-856)(-402)(-936),Vec(-819)(733)(344),Vec(733)(453)(-744),Vec(-771)(775)(374),Vec(-856)(-524)(270),Vec(-684)(729)(312),Vec(569)(862)(740),Vec(-445)(677)(-613),Vec(573)(-570)(-760),Vec(319)(-421)(720),Vec(625)(796)(681),Vec(-473)(783)(-591),Vec(-826)(-560)(397),Vec(275)(-321)(716),Vec(707)(-712)(-747),Vec(726)(468)(-669),Vec(-870)(-525)(-833),Vec(-767)(-622)(303),Vec(480)(-348)(692),Vec(-536)(687)(-585),Vec(-873)(-406)(-932),Vec(-86)(62)(-41),Vec(743)(436)(-815),Vec(512)(787)(729)]
   , makeScanner 18 [Vec(824)(596)(800),Vec(-375)(-387)(825),Vec(742)(692)(-620),Vec(-595)(-828)(-727),Vec(-317)(-417)(904),Vec(-444)(436)(525),Vec(593)(-719)(531),Vec(83)(56)(92),Vec(-667)(690)(-647),Vec(-417)(-496)(866),Vec(787)(697)(-577),Vec(-598)(-745)(-761),Vec(441)(-580)(-478),Vec(442)(-521)(-434),Vec(-668)(-819)(-668),Vec(610)(692)(-510),Vec(432)(-701)(-360),Vec(-504)(367)(620),Vec(-444)(529)(688),Vec(-667)(528)(-757),Vec(24)(-92)(-26),Vec(508)(-656)(667),Vec(-651)(641)(-806),Vec(468)(-795)(599),Vec(951)(619)(820),Vec(766)(664)(885)]
   , makeScanner 19 [Vec(572)(-510)(-553),Vec(-15)(68)(35),Vec(-141)(1)(151),Vec(-776)(814)(752),Vec(-443)(645)(-424),Vec(-420)(-729)(496),Vec(641)(-658)(875),Vec(468)(-538)(-454),Vec(-485)(545)(-351),Vec(-600)(-460)(-306),Vec(399)(650)(478),Vec(-862)(733)(700),Vec(517)(-571)(-466),Vec(296)(527)(492),Vec(-639)(-576)(-224),Vec(300)(531)(475),Vec(-818)(775)(540),Vec(416)(629)(-509),Vec(619)(-552)(903),Vec(-445)(704)(-352),Vec(272)(590)(-566),Vec(647)(-562)(812),Vec(-656)(-400)(-219),Vec(-470)(-535)(533),Vec(-438)(-635)(443),Vec(484)(611)(-540)]
   , makeScanner 20 [Vec(-770)(599)(586),Vec(683)(836)(701),Vec(-556)(-879)(621),Vec(-662)(582)(636),Vec(612)(796)(-777),Vec(799)(-663)(-898),Vec(-652)(-884)(499),Vec(542)(826)(-745),Vec(569)(778)(813),Vec(673)(-742)(-862),Vec(537)(-779)(665),Vec(-725)(406)(578),Vec(576)(-868)(615),Vec(-410)(-392)(-888),Vec(761)(-730)(-884),Vec(-679)(674)(-590),Vec(562)(-943)(717),Vec(436)(830)(-772),Vec(-534)(-403)(-830),Vec(72)(-129)(67),Vec(108)(1)(-113),Vec(-455)(-920)(548),Vec(-632)(731)(-469),Vec(-688)(645)(-337),Vec(-550)(-386)(-896),Vec(673)(785)(779)]
   , makeScanner 21 [Vec(-661)(-356)(-544),Vec(912)(680)(752),Vec(-722)(-409)(263),Vec(-662)(-480)(-390),Vec(-473)(648)(-554),Vec(731)(750)(711),Vec(648)(-303)(-658),Vec(-652)(-531)(-491),Vec(830)(-518)(773),Vec(645)(-375)(-466),Vec(879)(441)(-445),Vec(-559)(823)(338),Vec(759)(410)(-483),Vec(862)(-729)(816),Vec(-374)(507)(-530),Vec(-599)(845)(329),Vec(-726)(-462)(310),Vec(880)(-602)(809),Vec(-722)(834)(307),Vec(895)(522)(-442),Vec(910)(674)(720),Vec(-668)(-345)(354),Vec(-20)(-25)(-124),Vec(-413)(613)(-578),Vec(75)(88)(4),Vec(652)(-396)(-485)]
   , makeScanner 22 [Vec(747)(-397)(-696),Vec(-259)(-670)(-571),Vec(-603)(633)(778),Vec(-274)(-732)(715),Vec(442)(867)(939),Vec(-580)(823)(701),Vec(-534)(852)(-485),Vec(679)(-384)(923),Vec(-513)(753)(709),Vec(-232)(-710)(558),Vec(854)(-376)(-610),Vec(-331)(-680)(-531),Vec(-274)(-659)(581),Vec(694)(-434)(926),Vec(833)(-319)(-830),Vec(701)(-520)(860),Vec(727)(479)(-630),Vec(907)(558)(-616),Vec(-546)(799)(-681),Vec(395)(889)(769),Vec(845)(474)(-523),Vec(20)(-79)(57),Vec(101)(89)(5),Vec(559)(852)(799),Vec(-345)(-750)(-485),Vec(-492)(867)(-609)]
   , makeScanner 23 [Vec(530)(607)(-919),Vec(-568)(473)(664),Vec(55)(-137)(-99),Vec(-457)(319)(-779),Vec(492)(-777)(409),Vec(-608)(444)(814),Vec(-472)(-950)(-867),Vec(425)(-700)(-843),Vec(471)(732)(408),Vec(-843)(-846)(837),Vec(-360)(-814)(-826),Vec(-555)(492)(785),Vec(581)(597)(-818),Vec(406)(606)(-765),Vec(378)(658)(478),Vec(412)(741)(481),Vec(446)(-707)(-824),Vec(-391)(-934)(-864),Vec(382)(-615)(409),Vec(-840)(-724)(770),Vec(-598)(418)(-755),Vec(-825)(-830)(776),Vec(353)(-703)(-651),Vec(-563)(358)(-731),Vec(333)(-728)(425)]
   , makeScanner 24 [Vec(-37)(35)(-48),Vec(836)(582)(-476),Vec(822)(520)(676),Vec(597)(-887)(463),Vec(-280)(-388)(443),Vec(742)(483)(-504),Vec(760)(636)(756),Vec(-474)(-568)(-719),Vec(754)(-929)(485),Vec(-714)(801)(-463),Vec(711)(516)(-559),Vec(731)(-887)(536),Vec(782)(-853)(-733),Vec(-265)(-373)(392),Vec(-634)(633)(398),Vec(-681)(729)(503),Vec(757)(-902)(-763),Vec(-770)(609)(532),Vec(843)(574)(830),Vec(94)(-88)(14),Vec(771)(-793)(-891),Vec(-550)(-427)(-700),Vec(-322)(-523)(404),Vec(-495)(-391)(-711),Vec(-669)(636)(-539),Vec(-727)(661)(-560)]
   , makeScanner 25 [Vec(-562)(-274)(-592),Vec(-169)(152)(-4),Vec(-575)(520)(-828),Vec(-459)(-276)(-537),Vec(560)(-584)(-802),Vec(-525)(-757)(483),Vec(216)(761)(734),Vec(587)(541)(-609),Vec(622)(-315)(815),Vec(497)(610)(-729),Vec(-717)(459)(544),Vec(772)(-258)(827),Vec(258)(738)(683),Vec(258)(604)(756),Vec(-510)(-275)(-694),Vec(-458)(380)(-843),Vec(-710)(393)(458),Vec(-695)(396)(408),Vec(-34)(8)(98),Vec(681)(-559)(-831),Vec(543)(-487)(-843),Vec(-464)(-672)(511),Vec(-554)(-756)(632),Vec(564)(618)(-799),Vec(757)(-273)(776),Vec(-411)(550)(-865)]
   , makeScanner 26 [Vec(594)(573)(-519),Vec(-440)(825)(-580),Vec(682)(-603)(463),Vec(540)(-658)(-252),Vec(-546)(-834)(-618),Vec(-536)(327)(553),Vec(57)(-24)(115),Vec(-505)(787)(-628),Vec(-558)(-769)(-421),Vec(804)(815)(933),Vec(677)(878)(872),Vec(755)(-703)(505),Vec(566)(-637)(-464),Vec(-661)(-587)(447),Vec(576)(571)(-686),Vec(-573)(-585)(481),Vec(764)(761)(850),Vec(754)(-544)(465),Vec(-422)(-805)(-494),Vec(597)(-619)(-396),Vec(617)(585)(-480),Vec(-43)(68)(-5),Vec(-522)(847)(-506),Vec(-736)(364)(530),Vec(-733)(-581)(430),Vec(-632)(377)(621)]
   , makeScanner 27 [Vec(710)(798)(653),Vec(-745)(352)(513),Vec(-927)(692)(-562),Vec(-942)(-757)(-894),Vec(481)(-661)(637),Vec(-838)(-386)(810),Vec(-168)(-76)(-145),Vec(-716)(-389)(743),Vec(-124)(46)(-8),Vec(-963)(547)(-552),Vec(569)(662)(-427),Vec(355)(673)(-369),Vec(-806)(-869)(-853),Vec(-926)(671)(-666),Vec(500)(-674)(758),Vec(452)(-621)(787),Vec(751)(841)(731),Vec(-926)(-838)(-891),Vec(-681)(444)(493),Vec(-822)(-404)(749),Vec(-864)(361)(486),Vec(327)(-772)(-806),Vec(426)(-631)(-782),Vec(360)(688)(-386),Vec(366)(-666)(-758),Vec(772)(705)(659)]
   , makeScanner 28 [Vec(-648)(648)(-709),Vec(-542)(-550)(535),Vec(771)(449)(693),Vec(672)(456)(769),Vec(702)(-310)(-612),Vec(-117)(25)(-97),Vec(659)(470)(742),Vec(-522)(-413)(-805),Vec(731)(-309)(-463),Vec(-574)(-556)(727),Vec(616)(677)(-768),Vec(-609)(730)(-617),Vec(797)(-790)(557),Vec(612)(728)(-791),Vec(-597)(861)(419),Vec(695)(773)(-875),Vec(694)(-792)(612),Vec(-637)(794)(504),Vec(792)(-394)(-491),Vec(-32)(148)(17),Vec(-720)(663)(-565),Vec(-410)(-281)(-789),Vec(-689)(894)(537),Vec(-506)(-331)(-640),Vec(-489)(-424)(651),Vec(746)(-791)(714)]
   , makeScanner 29 [Vec(295)(-675)(611),Vec(-385)(714)(686),Vec(781)(901)(-278),Vec(-712)(-652)(496),Vec(-467)(738)(727),Vec(629)(795)(754),Vec(429)(-696)(749),Vec(-336)(510)(-431),Vec(17)(-19)(12),Vec(65)(131)(149),Vec(645)(919)(668),Vec(709)(922)(-414),Vec(-613)(742)(692),Vec(-512)(-777)(-427),Vec(-732)(-777)(621),Vec(572)(922)(732),Vec(543)(-531)(-675),Vec(-502)(-813)(-572),Vec(-319)(505)(-446),Vec(536)(-714)(-758),Vec(339)(-662)(792),Vec(563)(-595)(-767),Vec(703)(860)(-321),Vec(-777)(-664)(580),Vec(-616)(-776)(-448),Vec(-377)(719)(-457)]
   , makeScanner 30 [Vec(250)(687)(-614),Vec(-588)(536)(800),Vec(-175)(148)(-171),Vec(379)(660)(-585),Vec(-157)(-10)(-10),Vec(-585)(-712)(773),Vec(629)(-588)(-789),Vec(-506)(-425)(-711),Vec(-571)(-840)(664),Vec(236)(-765)(556),Vec(-611)(587)(758),Vec(-21)(15)(-188),Vec(455)(496)(687),Vec(288)(741)(-662),Vec(541)(576)(773),Vec(232)(-711)(405),Vec(-560)(-682)(724),Vec(-499)(881)(-703),Vec(255)(-814)(523),Vec(-520)(727)(-649),Vec(501)(566)(701),Vec(-582)(807)(-765),Vec(-631)(-508)(-645),Vec(694)(-557)(-754),Vec(-745)(514)(758),Vec(596)(-588)(-632),Vec(-600)(-453)(-612)]
   , makeScanner 31 [Vec(625)(-736)(-620),Vec(-599)(-557)(877),Vec(-827)(629)(-456),Vec(-682)(563)(543),Vec(894)(-512)(638),Vec(504)(-661)(-646),Vec(-677)(-757)(890),Vec(-692)(566)(428),Vec(466)(551)(-556),Vec(84)(22)(78),Vec(-677)(-895)(-740),Vec(900)(-585)(659),Vec(-621)(723)(479),Vec(427)(460)(818),Vec(927)(-573)(750),Vec(375)(519)(805),Vec(421)(518)(624),Vec(-666)(-896)(-531),Vec(-836)(817)(-510),Vec(-589)(-889)(-689),Vec(10)(-134)(-93),Vec(-606)(-643)(785),Vec(443)(500)(-560),Vec(482)(-784)(-562),Vec(359)(455)(-477),Vec(-732)(747)(-460)]
   , makeScanner 32 [Vec(-747)(-436)(-842),Vec(729)(-654)(591),Vec(-514)(-782)(535),Vec(-849)(537)(719),Vec(654)(-393)(-375),Vec(-586)(-821)(688),Vec(-911)(438)(-549),Vec(-786)(-558)(-874),Vec(304)(373)(491),Vec(-890)(356)(649),Vec(347)(616)(-427),Vec(663)(-761)(590),Vec(-954)(406)(-760),Vec(-947)(388)(-633),Vec(345)(509)(379),Vec(-447)(-786)(617),Vec(665)(-742)(461),Vec(328)(623)(-406),Vec(456)(-395)(-461),Vec(548)(-405)(-460),Vec(307)(389)(410),Vec(-858)(358)(643),Vec(-773)(-302)(-847),Vec(-54)(-4)(19),Vec(520)(620)(-334)]
   , makeScanner 33 [Vec(666)(261)(-636),Vec(623)(-361)(427),Vec(-931)(538)(-515),Vec(-942)(524)(660),Vec(-126)(-99)(-69),Vec(-408)(-920)(565),Vec(-414)(-912)(705),Vec(-901)(597)(559),Vec(687)(395)(-498),Vec(-425)(-854)(581),Vec(577)(562)(345),Vec(-747)(-501)(-520),Vec(384)(554)(390),Vec(-723)(-419)(-561),Vec(709)(-493)(483),Vec(655)(-811)(-667),Vec(653)(305)(-455),Vec(768)(-766)(-626),Vec(652)(-614)(436),Vec(-928)(611)(-579),Vec(-906)(475)(463),Vec(560)(612)(453),Vec(1)(-55)(105),Vec(-751)(-647)(-555),Vec(643)(-746)(-751),Vec(-804)(595)(-493)]
   , makeScanner 34 [Vec(-553)(-629)(693),Vec(844)(-693)(-278),Vec(-579)(-390)(-633),Vec(569)(260)(-620),Vec(425)(774)(376),Vec(794)(-708)(-275),Vec(476)(759)(391),Vec(518)(218)(-643),Vec(-700)(294)(-671),Vec(-858)(354)(-660),Vec(-18)(-135)(69),Vec(708)(-715)(-341),Vec(-730)(245)(-646),Vec(-514)(-639)(810),Vec(-582)(-551)(-609),Vec(-584)(-436)(-579),Vec(-678)(756)(606),Vec(769)(-523)(875),Vec(437)(624)(433),Vec(-667)(720)(661),Vec(620)(-552)(874),Vec(496)(260)(-486),Vec(-686)(579)(585),Vec(-569)(-639)(783),Vec(741)(-462)(790)] ]
