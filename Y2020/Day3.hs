module AdventOfCode.Y2020.Day3 where

data Cell = Open | Tree
   deriving (Eq)

instance Show Cell where
   show Open = "."
   show Tree = "#"


type Vector = (Int,Int)
type Dimensions = Vector
type Coords = Vector
data Landscape = Landscape Dimensions [[Cell]]

type Input = [String]

build :: Input -> Landscape
build lines = let
   h = length lines
   w = if h == 0 then 0 else length (lines !! 0)
   grid = flip map lines $ map $ \char -> case char of
      '.' -> Open
      '#' -> Tree
   in Landscape (w,h) grid

get :: Coords -> Landscape -> Maybe Cell
get (x,y) (Landscape (w,h) grid)
   | x < 0 || y < 0 || h <= y = Nothing
   | otherwise = let
      x' = x `mod` w
      in Just (grid !! y !! x')

countTrees :: Landscape -> Vector -> Int
countTrees ls vec = aux (0,0) where
   aux :: Coords -> Int
   aux pos = case get pos ls of
      Nothing -> 0
      Just x  -> (fromEnum (x == Tree)) + aux (addvec pos vec)   
   
addvec :: Vector -> Vector -> Vector
addvec (x,y) (u,v) = (x+u,y+v)

part1 :: Input -> Int
part1 input = countTrees (build input) (3,1)


part2 :: Input -> Int
part2 input = let
   ls = build input
   r1 = countTrees ls (1,1)
   r2 = countTrees ls (3,1) 
   r3 = countTrees ls (5,1)
   r4 = countTrees ls (7,1)
   r5 = countTrees ls (1,2)
   in r1 * r2 * r3 * r4 * r5


sample :: Input
sample =
   [ "..##......."
   , "#...#...#.."
   , ".#....#..#."
   , "..#.#...#.#"
   , ".#...##..#."
   , "..#.##....."
   , ".#.#.#....#"
   , ".#........#"
   , "#.##...#..."
   , "#...##....#"
   , ".#..#...#.#" ]
   
myInput :: Input
myInput =
   [ ".#.....#..#..#....##.........#."
   , "...#...#.........#..#.#..#....."
   , "#.#...#.#....#.....#..#..##..##"
   , "..#..#.#.#.....#..#..#..##....."
   , ".#..........#....####..##.#..#."
   , "....##.......#.#.....#........."
   , "....#......#....####.#.##......"
   , "........##..........##......#.."
   , ".........#........##..#.#.....#"
   , ".#..##..........#..#...#..##.#."
   , "........#........#.....#....#.#"
   , "..#.......#.###...#.......##..."
   , ".##..##.#...#........#........."
   , "...#....#..#..#..##.......#..#."
   , ".#.#.##.##..##..#.#.....#.....#"
   , "....#.........#........#....##."
   , "........#........#....###.#..#."
   , "........#....#......##........."
   , ".###.##.#.............##......."
   , "....#.........#...#.#.##..#...."
   , "#.............#.#.#.#..#..#..##"
   , "###...###.###..#........#......"
   , "##..#.....#....##..##.........."
   , ".......#...#....#...#...#.....#"
   , "...#......###...##.###...#...#."
   , "#.......#...##..#.......#..#..."
   , ".....##....#....#..#..#.#.##..#"
   , ".........#....##.#.#..##.#....."
   , ".....#......#.#.#.....#.....#.."
   , "..#..#...#.#...#.........##.#.."
   , ".....#..#.................#.#.."
   , "##.#....##........#......#....."
   , "#..#...##...#.#.#..#..........."
   , ".#..####.....#......#.###......"
   , ".#.......##............#....#.."
   , ".#.........##..#.##...#.....###"
   , "....##.........#.#...####...##."
   , "..#.......#......##.....#.#..#."
   , "...##....#..#..##....##...#.#.#"
   , ".................#............."
   , "...#.##..#.##..............#..."
   , "...#......#.........##........#"
   , "..#.#..##...#.......#.#........"
   , ".###.#.....#.##.##.#...#...#..."
   , ".....#.##.....#..#......#..#..."
   , ".....#.#...#........#..#..#..#."
   , "#...#.##.#....#................"
   , "..#...#.#..#.....#.#.#........."
   , "#.#.###...#.....##........##..."
   , "#..##.##....#..........##.#...#"
   , "...#..#.#.###...##......#.#...."
   , ".#..#........##...#......#.#.#."
   , "##........###....#.#....#......"
   , "....#...........#.........#...."
   , "#.#....#..#.....#.#....#.....#."
   , "........###.......#..#.#.#.#.#."
   , "..#....#.....#...............##"
   , ".....#..##....#.#...####......."
   , ".#..#.....#..#.....#....#....#."
   , "..##....#...........#.#....#..."
   , "..#.#......#..#.#..#.....###.#."
   , "...........................##.."
   , "##.....#....#......###.#...#..#"
   , "...#...#.........#..#..#....#.."
   , "....#####.#.#.#....#..#........"
   , ".##.#..#.#............###......"
   , "##.#...##...##....#...#...##..."
   , "..#.#.....#.......#..##..###.##"
   , "#..##...........#.##.....#.##.."
   , "#...#....#...#..##...#.#...#.#."
   , ".#..#...........###...#.#...#.."
   , ".#.....#......#.#......#...#..#"
   , ".#...##.##...............#....#"
   , "..#.........#....#............."
   , ".#..##..#.#................#..."
   , "..#.#.#.#.................#.#.#"
   , "...#..#.#..#.#......#........#."
   , "##....#......###.#......#......"
   , "..#....##.....#..#........#...."
   , ".#.#....#...#.#.....###..#...#."
   , ".#..#...##.....#.#...#.....#.#."
   , "...#....#....##....##.....#...."
   , ".......#...#...##..#.#.......#."
   , ".###..#..###.#.#.#.#.#.....##.."
   , "....#.#......###.#....#....#..#"
   , "##.....#.....##.#.....#....#..."
   , "......#...##...#..#.#.....#...."
   , "...#.........###.....#..##....."
   , "....#...#..#....#..#.........##"
   , ".#........#..#.....#.##.#....#."
   , ".......#......#.##...##.#..#..."
   , "#......#.......##..##..#.#....."
   , "..#.##..........#.#..#......#.."
   , "#.....#.......#......#........."
   , "...##......##...........#.#...."
   , ".#....#........#...#.#..#.....#"
   , ".#...#...##......##...##...##.#"
   , ".#.#.##.....##....#.#.#..#....."
   , "...#..#........#.....#.#.#####."
   , "#..#..#......#....##....##....."
   , ".#.............#....###.##.#..."
   , ".#....#.......#.#.....#......##"
   , "#..#.#.#........#...#..#...#..."
   , "#.#.#.....#.......#.##..#.....#"
   , "..#....#.....#...##.#...##....."
   , "......#..#.............###...#."
   , "..#...#.#....###...#..........."
   , ".........#..#..#....#..#......."
   , "#....#.....#..#....#.#..##....."
   , ".#..#.#.....#...##.....##......"
   , ".....####..#..#......#....##..#"
   , "#.#....#....#.##.......#.#....."
   , "....#.#.............##..#.#...#"
   , "....#.#.#.....##.....##..#...#."
   , ".#..#...#....#...#.#....#...#.."
   , ".#..#.#.#.......#...#.........."
   , "...##..#..#...##.....#.......#."
   , "..##...##.#..#.......#........."
   , ".##.#.......##...#...#......#.#"
   , "##.#.#..#...#............#....."
   , "..#.##...##..#....##..#......#."
   , "...#..........#.....#.#........"
   , "...#..#..#.......#.#.....##...."
   , "##.............#.....#.##...#.."
   , "#.#......#........#...#.##..#.#"
   , "...#..#...##.#.#........#.#...."
   , "#.....##...........#....#......"
   , "...##....#..#.#...#........#..."
   , "..##..####..#..#..............."
   , ".#.#..#......#.##.........##.#."
   , ".##....#...##.#...#..##..#....."
   , "........#........#.###.#.#....#"
   , "......##...#......#..#..#......"
   , "..#.......#...#..##........#..#"
   , ".#....###..###....###...##.#.##"
   , "#.#....#..#.#...#.#...##...#..."
   , "..#..##......#..#......####...."
   , ".#....###.......#...##...#....."
   , "...#....#..#.....#..#...####.#."
   , "............#.####..##...#..##."
   , ".#..#.......#....#...#......#.#"
   , ".......#.......#..#.#.........."
   , "...#.#............#..#......#.."
   , "..#...........#...##......#...#"
   , "...##......#.........#.#...#.##"
   , ".#..#..#..#......#...........#."
   , "....#.....#.###........#......."
   , "..##.#.#........#.#...##....#.."
   , ".#.#........##....#...#......#."
   , ".......#.##..###..............."
   , "#..#...##.....##........##....#"
   , "...####........#...#.........##"
   , "...#..............##..#........"
   , "......#.....#....#.......#....#"
   , "..###......#..##.....##....##.."
   , "##...#.....#..#.#.#...#.....#.."
   , "...#....#............#........."
   , "..#..##...#..#.........#......."
   , ".#.#.#...##..........#..###...."
   , ".......##.#.#.#...#.#...#.....#"
   , "..#..#..#..#...###.....#.##...."
   , ".#.#.....#.....##.#..#...###..#"
   , ".........#..##......##...##.#.#"
   , "#.........##..#......#..#.#.#.."
   , ".#..##.#.##......##........#..."
   , "..#...#.....##..#......#.....##"
   , ".#..#...#......#..#...#.....##."
   , "..#..##...#.....#.....#........"
   , "....##..#....#.#....#......#.#."
   , "..#.......##..#..#.##.#..#...##"
   , "...#..........#...#..##........"
   , "..#............#.#......#......"
   , ".#...##.......#...#.#........#."
   , ".#...#....#..#....#....#.#...#."
   , "......#..#.#..#..............#."
   , ".....#.##.#...............##.##"
   , ".#...............#.....#..#...#"
   , ".#..##.......#.#...#..#..#....#"
   , "..#..###.##........##.........."
   , ".#....#..##...#.#.........#...."
   , ".......#.....#....###...##.#.#."
   , "##..#.#...##.##.##....##.#.###."
   , "#.#...........#..#.#..........."
   , "....#..#..#..#...#....#.......#"
   , "........##....#..#......##.#..."
   , ".#.#..##...##...#....#..#.###.."
   , "#..##....#..#...#.......##....."
   , "..###..#.###......#..####....#."
   , ".....#..#........##.#..#......."
   , ".#......##..............#.#.#.."
   , "..#.#.......##...#....#.#.###.."
   , "#..#..#...###..#..............."
   , "......#..#.....#..#..#...#....."
   , ".#...#..........###..#..#.#...."
   , ".#......##..#......#.....###..#"
   , ".......#...#..#....###.....#..."
   , "#....#.......###.##.....##....#"
   , "..#.....#..##..#.........##...."
   , ".....##....#.#......#.........."
   , "....#...#...#......##.....##.#."
   , "........#.#.#......#..........."
   , ".#....#...#...#....#.....#...#."
   , "..............#..##.#.....###.#"
   , ".#......##.....##...#....#....."
   , ".............#.##......#.....#."
   , ".#....#.#............#.#..##..."
   , ".#...##.......#..#...##....#..."
   , ".#.....#..........#............"
   , "#.#.#........#.....#..#....##.."
   , "#....#.##......#...#..........."
   , "........#.##.....#...##.....#.."
   , "..#.##....#.##.#...#.#.#....#.."
   , "......#.......####......#.#...#"
   , "#...#.##.####......#.....##...."
   , ".#..#....#.......#...##.....#.."
   , "................#......#.##...."
   , "###...##..#.#..........#....#.#"
   , "#.#..#.....#..##.##.##...#...##"
   , "..#.......#.......#..##..#..##."
   , "......#.##.......#..#.....#...#"
   , ".##..##..#.#.......#..#......#."
   , "....##.#....#...##.#..#.....#.#"
   , "..#..#.........###.#..........."
   , "....#.......#....##......#....#"
   , "..........#...#......#....#...#"
   , "..#.#....###.....#..#.#.#..#..."
   , ".....#...##..#.##........####.."
   , "##.............#....##........#"
   , "..#..........#..##.#..........."
   , "##.#.......#.#....#......#.#..."
   , "........####.....##.#.........#"
   , ".....#...#.#.....#.##..##.#...."
   , "........#...#.#.#.#...#......#."
   , ".#..#.#....#.#...##.....#..#..."
   , ".....#.#............#.#.#......"
   , "....##.#...#...#.##...##......."
   , ".........#.##.....#.......#...#"
   , "...........###....#.#....#...#."
   , ".#..#.###......#..#............"
   , "#...#..#......#.#...#......#..."
   , "..##.#.#........#........##..##"
   , "..#.#.##..##....#........#.#.#."
   , "...#........###......#.#.....#."
   , "#.#.#.##........#.#...#..#....."
   , "#..#...............#...#.#...#."
   , ".....##......#...#.....#..#...."
   , "............#...#...#.##.#....#"
   , "...#..#..#...##.#....#.#..#.#.."
   , "##.#..#..............##........"
   , ".#.#..#.#..#....##..#.#.##.##.."
   , "......######....##.....#......."
   , ".#.......#..........#.#..#.#..#"
   , "..........#.#......#...##......"
   , "#..........#.#..#.............#"
   , "...#...#..#...................."
   , "....#...#.....#.....##.....#..."
   , "..#....##.....#..#......#......"
   , ".#.#.....#..##.##..........###."
   , ".#.##....#....#....#....#...#.."
   , "..##.....................##.#.."
   , ".....#..##....#.#.....##..#...."
   , ".####...#...##..#.##...#..#...."
   , ".........#.#...#.......###....."
   , "...#..#........#..#..##.....#.."
   , "..#....#....#....###.....#....."
   , "......#....#..#.........#......"
   , "#.#...#..#..#.#...#..#.#......#"
   , "..........#..........#.#.##...."
   , ".#..###..##..#....#.#.....#..#."
   , ".##......#..#.##...#.........#."
   , "...##...#....#.........#..#...."
   , "....#..##........#.........#..."
   , ".........##....#...#.#.....#..#"
   , ".#..........##...#..#.#..##...."
   , "#.......#...#...#............#."
   , ".....##.#.##.......#.......#..."
   , "...........#...#.....###.....#."
   , "#..................#.##..##...#"
   , ".........##.............#...#.#"
   , "#.#.....##...#........###....##"
   , "...##..#.##.....###.....#......"
   , "..#...#.#..#......##.#.......#."
   , ".........##.#...........###..#."
   , "..#...#.....#...#.#.....#..#..."
   , ".....##..#...#.#.#....#.....###"
   , "..#.#....#..#..#..#....#.#...#."
   , "........##....#......#....#..#."
   , ".##..#.....#.#....#..#.###....."
   , "..............##.........#.#.#."
   , ".##....#.#..#..#...#..........#"
   , ".....##.......#....#..#......#."
   , "...#.#....................#..##"
   , "#.##..#.#...#...#....#.#....##."
   , "...#.#..#.###................#."
   , ".....##..#.##.#.#.........#.#.."
   , ".................##..........#."
   , "..#......#........#.#....#....."
   , "#......##......#......###....#."
   , "....##....#..#..####......#...#"
   , ".##.##.........#...#..#....#.#."
   , ".#..#....##...##..#...........#"
   , "#...#......#...#...........#..."
   , "...#...####.............##..#.."
   , ".....#....##............##....#"
   , "......##.#...##...........#.#.."
   , "..#......##.....###.......#.###"
   , "...#...#......#...##.#........#"
   , ".#.........##.##......##......."
   , "....................#....#....#"
   , ".#.#.#........##.#....#.....#.."
   , "#.#.....####..#.........#.#.#.."
   , "...####..#..............#.#...."
   , "....#.#....#..........#....#..."
   , ".#..#..#.#...#..#.#............"
   , ".#.#.......##........##.....#.."
   , "#.#.##..#.....##......##....#.#"
   , "......#...#...#...#......#....."
   , ".........##..#.....#.####.#.#.."
   , ".....#....#.###...#.###.#..#..#"
   , "..#.#..#..#.......#.......##..."
   , ".....#.........#......##.#....#"
   , "..#.#.##....#.#...............#"
   , ".....#..#....##......##..###..." ]